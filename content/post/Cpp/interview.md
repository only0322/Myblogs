---
title: "C++面试题总结"
date: 2020-09-26T17:02:02+08:00
draft: true
---

## 1.多态的实现

存在虚函数的类至少有一个(多继承会有多个)一维的虚函数表叫做虚表(virtual table)，属于类成员，虚表的元素值是虚函数的入口地址，在编译时就已经为其在数据端分配了空间。

编译器另外还为每个类的对象提供一个虚表指针(vptr)，指向虚表入口地址，属于对象成员。

在实例化派生类对象时，先实例化基类，将基类的虚表入口地址赋值给基类的虚表指针，当基类构造函数执行完时，再将派生类的虚表入口地址赋值给基类的虚表指针（派生类和基类此时共享一个虚表指针，并没有各自都生成一个），在执行父类的构造函数。


以上是C++多态的实现过程，可以得出结论：

- 1.有虚函数的类必存在一个虚表。
- 2.虚表的构建：基类的虚表构建，先填上虚析构函数的入口地址，之后所有虚函数的入口地址按在类中声明顺序填入虚表；派生类的虚表构建，先将基类的虚表内容复制到派生类虚表中，如果派生类覆盖了基类的虚函数，则虚表中对应的虚函数入口地址也会被覆盖，为了后面寻址的一致性。


虚函数表中有序放置了父类和子类中的所有虚函数，并且相同虚函数在类继承链中的每一个虚函数表中的偏移量都是一致的。所以确定的虚函数对应virtual table中一个固定位置n，n是一个在编译时期就确定的常量，所以，使用vptr加上对应的n，就可以得到对应的函数入口地址。

C++采用的这种绝对地址+偏移量的方法调用虚函数，查找速度快执行效率高，时间复杂度为O(1)

这里概括一下虚函数的寻址过程：

- 1、获取类型名和函数名

- 2、从符号表中获得当前虚函数的偏移量

- 3、利用偏移量得到虚函数的访问地址，并调用虚函数。vptrn


## 2.const关键字

常变量： const 类型说明符 变量名

常引用： const 类型说明符 &引用名

常对象： 类名 const 对象名

常成员函数： 类名::fun(形参) const

常数组： 类型说明符 const 数组名[大小]

常指针： const 类型说明符* 指针名 ，类型说明符* const 指针名

