---
title: "趣谈网络协议学习笔记"
date: 2020-10-16T21:09:41+08:00
draft: true
---

## 一、通讯协议综述

### 1.有了IP地址为什么还需要Mac地址？

IP地址相当于是传送数据到某个位置，但不知道具体给哪台计算机，MAC地址就是为了解决这个问题。

至于修改MAC地址，实际上是修改了系统读取出来的这个MAC地址。也曾出现过两块劣质的网卡都是同一个MAC地址的情况，这样甚至会导致网络的堵塞。

**mac是身份证，ip是地址。**

**用总经理和员工来比喻网络协议**

不准确，因为开会的时候员工未必会给会议提出建议，而一次tcp的三次握手，每次握手ip和mac层都加入了自己的包头。


### 2.学习的方法

理解网络协议的工作模式，有两个小窍门：始终想象自己是一个处理网络包的程序：如何拿到网络包，如何根据规则进行处理，如何发出去；始终牢记一个原则：只要是在网络上跑的包，都是完整的。可以有下层没上层，绝对不可能有上层没下层。

### 3.网段

![网段图](/images/geek/net/ip.png)

私有IP地址是可以重复的，共有的则必须唯一。网段的划分是为了弥补刚开始对于计算机数量估计严重不足的问题。

lo 全称是 loopback，又称环回接口，往往会被分配到 127.0.0.1 这个地址。这个地址用于本机通信，经过内核处理后直接返回，不会在任何网络中出现。

也就是说本机通信是不会走到网卡的，socket对于本机通信的处理速度也会非常快。

### 4.动态主机配置协议（DHCP）

一个新机器加入一个网络的时候，会用IP地址0.0.0.0发送广播包，目标为255.255.255.255，封装了BOOTP协议。

内容大概如下：

![DNCP](/images/geek/net/dbcp.png)

DHCP会给新人分配IP地址，若新机器收到了多个DHCP服务分配的ip地址，一般会使用第一个，然后告诉其他的DHCP server，它们分配的IP地址没有被使用。

**IP 地址的收回和续租**

大概在租期过去50%的时候，机器会给DHCP服务发送报文，更新自己的ip地址信息。


### 5.MAC层、ARP和交换机

- 交换机的学习能力：交换机一开始会广播数据，后面知道目标的MAC地址之后，就会固定往这个端口发送数据了。

- MAC层用来解决多路访问的堵车问题：

- 将一根网线在交换机上短接，交换机会发现自己无法发送数据，一直在向外广播，就会形成广播风暴。

- ARP靠询问广播的方式寻找目标的MAC地址，之后会记入缓存。


### 6.STP协议

简单来说就是生成一个树，统一管理下面的节点，防止广播风暴问题。

![STP](/images/geek/net/stp.png)

