---
title: "Node.js后端面试整理"
date: 2022-03-07T11:06:57+08:00
draft: true
---

# 一、Node.js语言部分

## I.语言基础

### 1.闭包的原理

函数就是一个闭包，js的特点是可以在函数内部创建另一个函数。js可以在函数内用外部的变量，所以自然而然产生的闭包概念。

```js
function foo(){
  var local = 1
  function bar(){
    local++
    return local
  }
  return bar
}

var func = foo()
func()
```

在内部的那个函数可以引用外部的变量，但同时这个变量也无法被销毁，有消耗内存的风险。


#### 块级作用域 

{}也是划分作用域的概念，和闭包略有不同。

### 2.Js的内置对象

Object、Array、Boolean、Number、String、Buffer等等。

### 3.Nodejs gc

#### 引用计数法

假设有一个对象A，任何对象对A进行引用，那么对象A的引用计数器+1，当引用失效时，对象A的引用计数器-1，当对象A的引用计数器为0时，就说明对象A没用被引用，那么就可以进行回收。

##### 优点：
- 实时性高 不需要等内存不足再回首。

- 垃圾回收的时候不需要挂起应用。

- 区域更新对象，不需要扫描全部对象

##### 缺点：
- 每次对象被引用都要更新

- 浪费cpu资源，因为内存足够的时候还在统计

- 无法解决循环引用

比如两个对象互相引用 都赋值成null，那就永远回收不了了。

#### 标记清除法

标记清除法是把gc分为两个阶段，标记和清除。

- 标记：从根节点开始标记引用的对象

- 清除：没被标记的就是垃圾对象 可以清除。

结构有点像多叉树。

从根节点开始遍历，找到所有可达的对象，其他的都是可以清除的。

##### 优点

解决了循环引用的问题

##### 缺点

标记和清除都需要遍历所有对象，gc的时候需要暂停程序。对交互性高的程序体验很差。

内存碎片多，被清理的对象在内存的各个角落。

#### 标记压缩算法

标记压缩算法是在标记清除法的基础上进行了优化，标记阶段是一样的，在清理阶段不是直接清理标记对象，而是将存活对象压缩到内存的一端，然后清理边界以外的垃圾，从而解决碎片化问题。


##### 优缺点

解决了内存碎片化的问题，但是多了压缩的一步，对象移动内存位置的步骤，对效率有影响。

## II.libuv原理

libuv底层是用了生产者-消费者的模型，libuv在整个生命周期中，每一次循环都执行每个阶段（phase）维护的任务队列。逐个执行节点里的回调，在回调中，不断生产新的任务，从而不断驱动libuv。

### Nodejs的事件循环原理

事件循环底层使用libuv。
#### Nodejs的特点

单线程，它不会为每个请求分配一个线程，而是用主线程处理所有请求，对输入输出进行异步处理，避开了创建销毁线程，和线程切换的开销和复杂性。

#### 核心原理

Node.js 在主线程里维护了一个事件队列，当接到请求后，就将该请求作为一个事件放入这个队列中，然后继续接收其他请求。

当主线程空闲时(没有请求接入时)，就开始循环事件队列，检查队列中是否有要处理的事件，这时要分两种情况：如果是非 I/O 任务，就亲自处理，并通过回调函数返回到上层调用；如果是 I/O 任务，就从 线程池 中拿出一个线程来处理这个事件，并指定回调函数，然后继续循环队列中的其他事件。

当线程中的 I/O 任务完成以后，就执行指定的回调函数，并把这个完成的事件放到事件队列的尾部，等待事件循环，当主线程再次循环到该事件时，就直接处理并返回给上层调用。 这个过程就叫 事件循环 (Event Loop)。

无论是 Linux 平台还是 Windows 平台，Node.js 内部都是通过 线程池 来完成异步 I/O 操作的，而 LIBUV 针对不同平台的差异性实现了统一调用。因此，Node.js 的单线程仅仅是指 JavaScript 运行在单线程中，而并非 Node.js 是单线程。

在事件队列中，如果前面的 CPU 计算任务没有完成，后面的任务就会被阻塞，出现响应缓慢的情况，当 Node.js 被CPU 密集型任务占用，导致其他任务被阻塞时，却还有 CPU 内核处于闲置状态，造成资源浪费。

## III.v8

### 1.内存限制

32位是0.7gb，64位是1.4gb

### 2.和Nodejs的关系

v8把js代码翻译成机器码，直接运行。

# 二、计算机网络

# 三、数据结构和算法

# 四、数据库

# 五、设计模式

# 六、Linux

# 七、容器云

# 八、Redis

# 九、操作系统